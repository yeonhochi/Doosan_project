<img src="https://github.com/user-attachments/assets/a66d203d-aad3-4c32-935c-236dfc5f3d3f" width="500">

<img src="https://github.com/user-attachments/assets/3916763b-f4cd-44e2-84ce-ea3dce010875" width="500" height="550">


# auto_mapping_cleaning ν”„λ΅μ νΈ κ°μ”

`auto_mapping_cleaning` ν”„λ΅μ νΈλ” **ROS2 (Robot Operating System)** ν™κ²½μ—μ„ **μλ™ λ§¤ν•‘ λ° μ²­μ† κ²½λ΅ μƒμ„±**μ„ λ©ν‘λ΅ ν•©λ‹λ‹¤.  
μ΄ μ‹μ¤ν…μ€ **ν”„λ΅ ν‹°μ–΄ νƒμƒ‰ μ•κ³ λ¦¬μ¦**μ„ ν™μ©ν•μ—¬ **λ―Ένƒμ§€ κµ¬μ—­μ„ ν¨κ³Όμ μΌλ΅ νƒμƒ‰**ν•κ³ , μƒμ„±λ λ§µμ„ κΈ°λ°μΌλ΅ **μµμ μ μ²­μ† κ²½λ΅λ¥Ό μλ™μΌλ΅ κ³„ν**ν•©λ‹λ‹¤.

---

## π“ ν”„λ΅μ νΈ μ£Όμ” Task

μ΄ ν”„λ΅μ νΈλ” λ‹¤μκ³Ό κ°™μ€ μ£Όμ” κΈ°λ¥μ„ ν¬ν•¨ν•©λ‹λ‹¤:

1. **ν”„λ΅ ν‹°μ–΄ μ•κ³ λ¦¬μ¦ κΈ°λ° λ―Ένƒμ§€ κµ¬μ—­ νƒμƒ‰**
   - LiDAR μ„Όμ„λ¥Ό ν™μ©ν• μ‹¤μ‹κ°„ ν™κ²½ μ¤μΊ”  
   - νƒμƒ‰μ΄ μ™„λ£λμ§€ μ•μ€ μμ—­μ„ μλ™μΌλ΅ κ°μ§€ λ° μ΄λ™  

2. **μƒμ„±λ λ§µ κΈ°λ° μ²­μ† κ²½λ΅ μƒμ„±**
   - SLAMμ„ ν†µν•΄ κµ¬μ¶•λ λ§µμ„ ν™μ©ν• κ²½λ΅ κ³„ν  
 
---

# λ™μ‘ μμƒ -> https://youtu.be/AaGLtqbv9YM

---

# mapping μ½”λ“ μ„¤λ…

1οΈβƒ£ μ΄κΈ°ν™” λ° κµ¬λ…/λ°ν–‰ μ„¤μ •

    /map ν† ν”½μ„ κµ¬λ…ν•μ—¬ OccupancyGrid(λ§µ λ°μ΄ν„°) λ¥Ό κ°€μ Έμ΄
    /follow_path/_action/status ν† ν”½μ„ κµ¬λ…ν•μ—¬ λ΅λ΄‡μ λ©ν‘ λ„μ°© μ—¬λ¶€λ¥Ό ν™•μΈ
    /odomμ„ κµ¬λ…ν•μ—¬ λ΅λ΄‡μ ν„μ¬ μ„μΉ(x, y) μ •λ³΄λ¥Ό μ—…λ°μ΄νΈ
    goal_pose ν† ν”½μ„ λ°ν–‰ν•μ—¬ λ‹¤μ λ©ν‘ μ§€μ (goal)μ„ μ „μ†΅

2οΈβƒ£ map_callback() β†’ λ§µμ„ numpy λ°°μ—΄λ΅ λ³€ν™

    ROS 2μ OccupancyGrid λ©”μ‹μ§€λ¥Ό numpy λ°°μ—΄λ΅ λ³€ν™ν•μ—¬ λ§µ λ°μ΄ν„°λ΅ μ €μ¥
    λ§µμ ν¬κΈ°(λ„λΉ„, λ†’μ΄) λ° ν•΄μƒλ„(metadata)λ„ ν•¨κ» μ €μ¥

3οΈβƒ£ goal_status_callback() β†’ λ©ν‘ λ„μ°© μ—¬λ¶€ ν™•μΈ

    λ΅λ΄‡μ΄ λ©ν‘ μ„μΉμ— λ„μ°©ν–λ”μ§€ ν™•μΈ
        λ„μ°©ν–μΌλ©΄ goal_reached = True
        μ‹¤ν¨(Aborted)ν• κ²½μ°μ—λ„ μƒλ΅μ΄ λ©ν‘λ¥Ό μ„¤μ •ν•  μ μλ„λ΅ goal_reached = Trueλ΅ λ³€κ²½

4οΈβƒ£ timer_callback() β†’ 5μ΄λ§λ‹¤ μƒλ΅μ΄ λ©ν‘ μ„ μ •

    λ§µμ„ μ•„μ§ λ°›μ§€ λ»ν–κ±°λ‚(self.map_array is None)
    μ΄λ―Έ λ©ν‘ μ§€μ μΌλ΅ μ΄λ™ μ¤‘μ΄λΌλ©΄(goal_reached = False) β†’ μƒλ΅μ΄ λ©ν‘λ¥Ό μ„¤μ •ν•μ§€ μ•μ
    λ―Ένƒμƒ‰ μ§€μ—­(Unknown: -1)κ³Ό μΈμ ‘ν• μ΄λ™ κ°€λ¥ μμ—­(Free: 0)μ„ μ°Ύμ (ν”„λ΅ ν‹°μ–΄ νƒμƒ‰)
    μ¥μ• λ¬Όκ³Ό λ„λ¬΄ κ°€κΉμ΄ ν”„λ΅ ν‹°μ–΄λ” μ μ™Έ
    ν›„λ³΄ μ¤‘ ν•λ‚λ¥Ό λλ¤μΌλ΅ μ„ νƒν•μ—¬ λ©ν‘ μ§€μ μΌλ΅ μ„¤μ •

5οΈβƒ£ detect_frontiers() β†’ λ―Ένƒμƒ‰ μμ—­ μ°ΎκΈ°

    λ§µμ—μ„ κ°’μ΄ -1μΈ μ…€(λ―Ένƒμƒ‰ μμ—­) μ¤‘, μ£Όλ³€μ— 0(μ΄λ™ κ°€λ¥ κ³µκ°„)μ΄ μλ” κ²½μ°λ¥Ό νƒμƒ‰ κ²½κ³„(frontier)λ΅ λ¶„λ¥
    μ¦‰, λ΅λ΄‡μ΄ μ ‘κ·Όν•λ©΄ νƒμƒ‰μ΄ ν™•μ¥λ  μ μλ” μμ—­μ„ μ°Ύμ•„ λ¦¬μ¤νΈλ΅ λ°ν™

6οΈβƒ£ is_near_wall() β†’ μ¥μ• λ¬Ό(λ²½)κ³Ό κ°€κΉμ΄μ§€ ν™•μΈ

    ν›„λ³΄ μ§€μ μ΄ μ¥μ• λ¬Ό(κ°’=100)κ³Ό μΌμ • κ±°λ¦¬ μ΄λ‚΄λΌλ©΄ νƒμƒ‰ λ€μƒμΌλ΅ μ μ™Έπ› οΈ μ£Όμ” λ™μ‘ κ³Όμ •
1οΈβƒ£ μ΄κΈ°ν™” λ° κµ¬λ…/λ°ν–‰ μ„¤μ •

    /map ν† ν”½μ„ κµ¬λ…ν•μ—¬ OccupancyGrid(λ§µ λ°μ΄ν„°) λ¥Ό κ°€μ Έμ΄
    marker_waypoints ν† ν”½μ„ λ°ν–‰ν•μ—¬ RVizμ—μ„ μ›¨μ΄ν¬μΈνΈ μ‹κ°ν™”
    navigate_to_pose μ•΅μ… ν΄λΌμ΄μ–ΈνΈλ¥Ό μƒμ„±ν•μ—¬ Nav2λ¥Ό ν†µν•΄ λ΅λ΄‡μ„ μ΄λ™

2οΈβƒ£ map_callback() β†’ λ§µμ„ numpy λ°°μ—΄λ΅ λ³€ν™ ν›„ μ›¨μ΄ν¬μΈνΈ μƒμ„±

    ROS 2μ OccupancyGrid λ©”μ‹μ§€λ¥Ό numpy λ°°μ—΄λ΅ λ³€ν™ν•μ—¬ λ§µ λ°μ΄ν„° μ €μ¥
    μ§€κ·Έμ¬κ·Έ(Zigzag) ν¨ν„΄μΌλ΅ μ›¨μ΄ν¬μΈνΈλ¥Ό μλ™ μƒμ„±
        λ²½μ—μ„ μΌμ • κ±°λ¦¬(5μ…€ μ΄μƒ) λ–¨μ–΄μ§„ μ…€λ§ μ›¨μ΄ν¬μΈνΈλ΅ μ„ νƒ
        μ§μ ν–‰(row)μ—μ„λ” μ™Όμ½ β†’ μ¤λ¥Έμ½μΌλ΅ μ΄λ™
        ν™€μ ν–‰(row)μ—μ„λ” μ¤λ¥Έμ½ β†’ μ™Όμ½μΌλ΅ μ΄λ™

3οΈβƒ£ timer_callback() β†’ 1μ΄λ§λ‹¤ μ›¨μ΄ν¬μΈνΈ νƒμƒ‰ μ‹μ‘

    λ§µμ„ λ°›μ§€ λ»ν–κ±°λ‚ μ΄λ―Έ νƒμƒ‰ μ¤‘μ΄λΌλ©΄(is_navigating = True) μƒλ΅μ΄ λ©ν‘ μ„¤μ • X
    μ²« λ²μ§Έ μ›¨μ΄ν¬μΈνΈλ΅ μ΄λ™μ„ μ‹μ‘

4οΈβƒ£ send_next_goal() β†’ Nav2 μ•΅μ…μ„ μ‚¬μ©ν•μ—¬ μ΄λ™ λ…λ Ή μ „μ†΅

    ν„μ¬ μ΄λ™ν•΄μ•Ό ν•  μ›¨μ΄ν¬μΈνΈμ μΆν‘(x, y)λ¥Ό κ°€μ Έμ™€ PoseStamped λ©”μ‹μ§€ μƒμ„±
    Nav2 μ•΅μ… ν΄λΌμ΄μ–ΈνΈλ¥Ό ν†µν•΄ λ©ν‘λ¥Ό μ „μ†΅
    λ©ν‘λ¥Ό μ„¤μ •ν•λ©΄ goal_response_callback()μ—μ„ μ„±κ³µ μ—¬λ¶€ ν™•μΈ

5οΈβƒ£ goal_response_callback() β†’ Nav2μ—μ„ λ©ν‘λ¥Ό μλ½ν–λ”μ§€ ν™•μΈ

    Nav2κ°€ λ©ν‘λ¥Ό μλ½ν•λ©΄(Goal accepted.)
        get_result_callback()μ—μ„ λ©ν‘ λ„λ‹¬ μ—¬λ¶€λ¥Ό ν™•μΈ

6οΈβƒ£ get_result_callback() β†’ λ©ν‘ λ„μ°© ν›„ λ‹¤μ μ›¨μ΄ν¬μΈνΈ μ΄λ™

    ν„μ¬ μ›¨μ΄ν¬μΈνΈ λ„μ°© ν›„ λ‹¤μ μ›¨μ΄ν¬μΈνΈλ΅ μ΄λ™
    λ¨λ“  μ›¨μ΄ν¬μΈνΈ λ°©λ¬Έ μ‹ νƒμƒ‰ μΆ…λ£

7οΈβƒ£ update_markers() β†’ RVizμ—μ„ μ›¨μ΄ν¬μΈνΈ μ‹κ°ν™”

    μ΄λ΅μƒ‰(λ°©λ¬Έ μ™„λ£), λΉ¨κ°„μƒ‰(λ―Έλ°©λ¬Έ) μ μ„ μ‚¬μ©ν•μ—¬ μ›¨μ΄ν¬μΈνΈ ν‘μ‹
    λ°©λ¬Έν• μ›¨μ΄ν¬μΈνΈλ¥Ό λ¦¬μ¤νΈμ—μ„ μ κ±°ν•μ—¬ μ—…λ°μ΄νΈ
    μ΄ κ³Όμ •μ„ ν†µν•΄ λ΅λ΄‡μ΄ λ²½μ— λ¶€λ”νλ” κ²ƒμ„ λ°©μ§€

7οΈβƒ£ select_goal() β†’ λ©ν‘ μΆν‘λ¥Ό μ„ νƒν•μ—¬ μ‹¤μ  μΆν‘ λ³€ν™

    λλ¤μΌλ΅ ν”„λ΅ ν‹°μ–΄ ν›„λ³΄ μ¤‘ ν•λ‚λ¥Ό μ„ νƒ
    λ§µμ ν”½μ…€ μΆν‘(col, row) β†’ μ‹¤μ  μ›”λ“ μΆν‘(x, y) λ΅ λ³€ν™
    λ³€ν™μ‹:

    real_x = col * resolution + origin_x
    real_y = row * resolution + origin_y

8οΈβƒ£ publish_goal() β†’ λ©ν‘ μΆν‘λ¥Ό λ°ν–‰ν•μ—¬ λ΅λ΄‡ μ΄λ™

    PoseStamped λ©”μ‹μ§€ μƒμ„±ν•μ—¬ goal_pose ν† ν”½μΌλ΅ λ°ν–‰
    λ΅λ΄‡μ€ Nav2 κ²½λ΅ κ³„νμ„ ν†µν•΄ ν•΄λ‹Ή μ§€μ μΌλ΅ μ΄λ™
    λ©ν‘κ°€ μ„¤μ •λλ©΄ goal_reached = Falseλ΅ λ³€κ²½ν•μ—¬ μ¤‘λ³µ λ©ν‘λ¥Ό λ°©μ§€

9οΈβƒ£ main() β†’ ROS 2 λ…Έλ“ μ‹¤ν–‰

    ROS 2 λ…Έλ“λ¥Ό μ‹¤ν–‰ν•κ³  νƒμƒ‰μ„ μ§€μ†μ μΌλ΅ μν–‰

---
# cleaning μ½”λ“ μ„¤λ…

1οΈβƒ£ μ΄κΈ°ν™” λ° κµ¬λ…/λ°ν–‰ μ„¤μ •

    /map ν† ν”½μ„ κµ¬λ…ν•μ—¬ OccupancyGrid(λ§µ λ°μ΄ν„°) λ¥Ό κ°€μ Έμ΄
    marker_waypoints ν† ν”½μ„ λ°ν–‰ν•μ—¬ RVizμ—μ„ μ›¨μ΄ν¬μΈνΈ μ‹κ°ν™”
    navigate_to_pose μ•΅μ… ν΄λΌμ΄μ–ΈνΈλ¥Ό μƒμ„±ν•μ—¬ Nav2λ¥Ό ν†µν•΄ λ΅λ΄‡μ„ μ΄λ™

2οΈβƒ£ map_callback() β†’ λ§µμ„ numpy λ°°μ—΄λ΅ λ³€ν™ ν›„ μ›¨μ΄ν¬μΈνΈ μƒμ„±

    ROS 2μ OccupancyGrid λ©”μ‹μ§€λ¥Ό numpy λ°°μ—΄λ΅ λ³€ν™ν•μ—¬ λ§µ λ°μ΄ν„° μ €μ¥
    μ§€κ·Έμ¬κ·Έ(Zigzag) ν¨ν„΄μΌλ΅ μ›¨μ΄ν¬μΈνΈλ¥Ό μλ™ μƒμ„±
        λ²½μ—μ„ μΌμ • κ±°λ¦¬(5μ…€ μ΄μƒ) λ–¨μ–΄μ§„ μ…€λ§ μ›¨μ΄ν¬μΈνΈλ΅ μ„ νƒ
        μ§μ ν–‰(row)μ—μ„λ” μ™Όμ½ β†’ μ¤λ¥Έμ½μΌλ΅ μ΄λ™
        ν™€μ ν–‰(row)μ—μ„λ” μ¤λ¥Έμ½ β†’ μ™Όμ½μΌλ΅ μ΄λ™

3οΈβƒ£ timer_callback() β†’ 1μ΄λ§λ‹¤ μ›¨μ΄ν¬μΈνΈ νƒμƒ‰ μ‹μ‘

    λ§µμ„ λ°›μ§€ λ»ν–κ±°λ‚ μ΄λ―Έ νƒμƒ‰ μ¤‘μ΄λΌλ©΄(is_navigating = True) μƒλ΅μ΄ λ©ν‘ μ„¤μ • X
    μ²« λ²μ§Έ μ›¨μ΄ν¬μΈνΈλ΅ μ΄λ™μ„ μ‹μ‘

4οΈβƒ£ send_next_goal() β†’ Nav2 μ•΅μ…μ„ μ‚¬μ©ν•μ—¬ μ΄λ™ λ…λ Ή μ „μ†΅

    ν„μ¬ μ΄λ™ν•΄μ•Ό ν•  μ›¨μ΄ν¬μΈνΈμ μΆν‘(x, y)λ¥Ό κ°€μ Έμ™€ PoseStamped λ©”μ‹μ§€ μƒμ„±
    Nav2 μ•΅μ… ν΄λΌμ΄μ–ΈνΈλ¥Ό ν†µν•΄ λ©ν‘λ¥Ό μ „μ†΅
    λ©ν‘λ¥Ό μ„¤μ •ν•λ©΄ goal_response_callback()μ—μ„ μ„±κ³µ μ—¬λ¶€ ν™•μΈ

5οΈβƒ£ goal_response_callback() β†’ Nav2μ—μ„ λ©ν‘λ¥Ό μλ½ν–λ”μ§€ ν™•μΈ

    Nav2κ°€ λ©ν‘λ¥Ό μλ½ν•λ©΄(Goal accepted.)
        get_result_callback()μ—μ„ λ©ν‘ λ„λ‹¬ μ—¬λ¶€λ¥Ό ν™•μΈ

6οΈβƒ£ get_result_callback() β†’ λ©ν‘ λ„μ°© ν›„ λ‹¤μ μ›¨μ΄ν¬μΈνΈ μ΄λ™

    ν„μ¬ μ›¨μ΄ν¬μΈνΈ λ„μ°© ν›„ λ‹¤μ μ›¨μ΄ν¬μΈνΈλ΅ μ΄λ™
    λ¨λ“  μ›¨μ΄ν¬μΈνΈ λ°©λ¬Έ μ‹ νƒμƒ‰ μΆ…λ£

7οΈβƒ£ update_markers() β†’ RVizμ—μ„ μ›¨μ΄ν¬μΈνΈ μ‹κ°ν™”

    μ΄λ΅μƒ‰(λ°©λ¬Έ μ™„λ£), λΉ¨κ°„μƒ‰(λ―Έλ°©λ¬Έ) μ μ„ μ‚¬μ©ν•μ—¬ μ›¨μ΄ν¬μΈνΈ ν‘μ‹
    λ°©λ¬Έν• μ›¨μ΄ν¬μΈνΈλ¥Ό λ¦¬μ¤νΈμ—μ„ μ κ±°ν•μ—¬ μ—…λ°μ΄νΈ



